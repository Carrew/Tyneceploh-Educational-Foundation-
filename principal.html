<!DOCTYPE html>
<html>
<head>
  <title>Principal Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f8f8;
      padding: 20px;
    }
    h2 {
      color: brown;
      text-align: center;
    }
    .student-card {
      background: #fff;
      border: 1px solid #ccc;
      border-left: 5px solid brown;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    .status {
      font-weight: bold;
      margin-top: 10px;
    }
    .approved {
      color: green;
    }
    .rejected {
      color: red;
    }
    button {
      margin: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      color: white;
      cursor: pointer;
    }
    .approve-btn {
      background-color: green;
    }
    .reject-btn {
      background-color: red;
    }
    input[type="text"] {
      width: 80%;
      padding: 5px;
      margin-left: 5px;
      margin-right: 5px;
      border-radius: 3px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>

  <h2>Principal Dashboard - Grade Approvals</h2>
  <div id="container"></div>

  <script>
    const container = document.getElementById("container");
    // Load all pending grades submissions from localStorage
    let submissions = JSON.parse(localStorage.getItem("pending_grades") || "[]");

    // Save changes to localStorage and re-render
    function saveUpdates() {
      localStorage.setItem("pending_grades", JSON.stringify(submissions));
      render();
    }

    // Render all submissions on the page
    function render() {
      container.innerHTML = "";
      if (submissions.length === 0) {
        container.innerHTML = "<p>No pending submissions available.</p>";
        return;
      }

      submissions.forEach((student, index) => {
        const div = document.createElement("div");
        div.className = "student-card";

        div.innerHTML = `
          <h3>${student.name} (${student.period})</h3>
          <p><strong>Submitted:</strong> ${student.timestamp}</p>
          <table>
            <thead>
              <tr>
                <th>Subject</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody>
              ${student.grades.map(g => `<tr><td>${g.subject}</td><td>${g.grade}</td></tr>`).join("")}
            </tbody>
          </table>
          <div class="status ${student.status === 'approved' ? 'approved' : student.status === 'rejected' ? 'rejected' : ''}">
            Status: ${student.status.toUpperCase()}${student.feedback ? " - " + student.feedback : ""}
          </div>
        `;

        // Show Approve/Reject controls only if status is pending
        if (student.status === "pending") {
          // Approve button
          const approveBtn = document.createElement("button");
          approveBtn.textContent = "Approve";
          approveBtn.className = "approve-btn";
          approveBtn.onclick = () => {
            student.status = "approved";
            student.feedback = "Approved by principal";

            // Move approved submission to approved_results in localStorage
            const approved = JSON.parse(localStorage.getItem("approved_results") || "[]");
            approved.push(student);
            localStorage.setItem("approved_results", JSON.stringify(approved));

            // Remove submission from pending list
            submissions.splice(index, 1);
            saveUpdates();
          };

          // Reject button and reason input
          const rejectBtn = document.createElement("button");
          rejectBtn.textContent = "Reject";
          rejectBtn.className = "reject-btn";

          const reasonInput = document.createElement("input");
          reasonInput.type = "text";
          reasonInput.placeholder = "Reason for rejection";

          rejectBtn.onclick = () => {
            const reason = reasonInput.value.trim();
            if (!reason) {
              alert("Please enter a reason to reject.");
              return;
            }
            student.status = "rejected";
            student.feedback = reason;
            saveUpdates();
          };

          // Add buttons and input to card
          div.appendChild(approveBtn);
          div.appendChild(reasonInput);
          div.appendChild(rejectBtn);
        }

        container.appendChild(div);
      });
    }

    render();
  </script>

</body>
</html>
